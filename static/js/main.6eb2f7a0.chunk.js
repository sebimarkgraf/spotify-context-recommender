(this.webpackJsonprecommender=this.webpackJsonprecommender||[]).push([[0],{115:function(e,t){},132:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(21),c=n.n(a),o=n(9),s=n.n(o),l=n(14),u=n(16),d=n(25),f=n(12),v=n(13),h=n(30),b=n(72),m=n(71),j=(n(84),n(161)),p=n(162),g=n(152),y=n(137),O=n(153),x=n(68),k=n.n(x),w="ks_context.onnx",_={clientId:"cfd3ccbf529c4991b156b44819812436",clientSecret:"84336a1fc50b4d51af0e24a6e88dae85"},S="https://github.com/sebimarkgraf/spotify-context-recommender",C=n(3),R=function(){return Object(C.jsx)("footer",{children:Object(C.jsxs)(g.a,{maxWidth:"sm",children:[Object(C.jsxs)(y.a,{variant:"body1",color:"textSecondary",children:["Created with ",Object(C.jsx)("span",{role:"img",children:"\ud83d\udd0c"})," at home for Kontextsensitive Systeme ",(new Date).getFullYear()]}),Object(C.jsx)(O.a,{startIcon:Object(C.jsx)(k.a,{}),onClick:function(){return window.open(S)},children:"Repository"})]})})},F=function(){function e(t,n){var r=this;Object(f.a)(this,e),this.values=void 0,this.timeWindow=void 0,this.callback=void 0,this.timer=void 0,this.timeWindow=t,this.values={},this.callback=n,this.flush=this.flush.bind(this),this.timer=setInterval((function(){return r.flush()}),t)}return Object(v.a)(e,[{key:"push",value:function(e,t){this.values[e]||(this.values[e]=[]),this.values[e].push(t)}},{key:"flush",value:function(){0!==Object.keys(this.values).length&&(this.callback(this.values,Date.now()),this.values={})}}]),e}(),P=n(52),A=n(19),M=function(){function e(t){var n=this;Object(f.a)(this,e),this.session=void 0,console.log("Loading Model: "+t),A.InferenceSession.create(t,{executionProviders:["wasm"],logVerbosityLevel:4,logSeverityLevel:0}).then((function(e){n.session=e,console.log(e)})).catch((function(e){console.error("Failed loading model",e)}))}return Object(v.a)(e,[{key:"calculate_features",value:function(e,t){Float32Array.from([1,2,3,4,5,6,7,8,9,10,11,12]);for(var n={},r=0,i=Object.entries(e);r<i.length;r++){var a=Object(d.a)(i[r],2),c=a[0],o=a[1];n["min_".concat(c)]=new A.Tensor(Float32Array.from([Math.min.apply(Math,Object(P.a)(o))]),[1,1]),n["max_".concat(c)]=new A.Tensor(Float32Array.from([Math.max.apply(Math,Object(P.a)(o))]),[1,1]);var s=o.reduce((function(e,t){return e+t}),0)/o.length;n["avg_".concat(c)]=new A.Tensor(Float32Array.from([s]),[1,1]),n["sum_".concat(c)]=new A.Tensor(Float32Array.from([o.reduce((function(e,t){return e+t}),0)]),[1,1]),n["var_samp_".concat(c)]=new A.Tensor(Float32Array.from([Math.sqrt(o.reduce((function(e,t){return e+t*t}),0)/o.length-s*s)]),[1,1])}return n.hourOfDay=new A.Tensor(Float32Array.from([new Date(t).getHours()]),[1,1]),n}},{key:"infer",value:function(){var e=Object(l.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.session){e.next=3;break}return console.warn("Model not initialized"),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.session.run(t,{logVerbosityLevel:4});case 6:if(void 0!==(n=e.sent)){e.next=9;break}return e.abrupt("return");case 9:return i=n.prediction.data[0],r=["studying","driving","standing","sleeping","jogging"][i],e.abrupt("return",r);case 13:return e.prev=13,e.t0=e.catch(3),console.warn("Error when predicting "+e.t0),e.abrupt("return");case 17:case"end":return e.stop()}var i}),e,this,[[3,13]])})));return function(t){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(){return e._instance||(e._instance=new e(w)),e._instance}}]),e}();M._instance=void 0;var T=n(154),E=n(163),D=n(155),I=n(156),L=n(157),N=Object(T.a)((function(e){return{item:{cursor:"pointer",height:150,width:150,margin:e.spacing(1)},img:{objectFit:"cover"},imageList:{height:"100%",width:"100%",justifyContent:"center"}}})),q=function(e){var t=N(),n=e.key,r=e.playlist;return Object(C.jsxs)(D.a,{cols:1,className:t.item,onClick:function(){return window.open(r.external_urls.spotify)},children:[Object(C.jsx)("img",{src:r.images[0].url,alt:r.name,className:t.img}),Object(C.jsx)(I.a,{title:r.name,subtitle:Object(C.jsx)("span",{children:r.description})})]},n)},z=function(e){var t=N(),n=e.playlists.map((function(e){return Object(C.jsx)(q,{playlist:e},e.id)}));return Object(C.jsx)(L.a,{className:t.imageList,cols:2,children:n})},G=n(32),W=n(51),B=n.n(W),J=n(69),V=n.n(J);B.a._addMethods(V.a);var H=function(){function e(){var t=this;Object(f.a)(this,e),this.spotifyApi=void 0,this.getPlaylists=function(){var e=Object(l.a)(s.a.mark((function e(n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.spotifyApi.searchPlaylists(n);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var n=new B.a(Object(G.a)({},_));n.clientCredentialsGrant().then((function(e){console.log("The access token expires in "+e.body.expires_in),console.log("The access token is "+e.body.access_token),t.spotifyApi.setAccessToken(e.body.access_token)}),(function(e){console.log("Something went wrong when retrieving an access token",e)})),this.spotifyApi=n}return Object(v.a)(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();H.instance=void 0;var K=Object(T.a)((function(e){return{box:{display:"flex",flexDirection:"column",marginTop:e.spacing(1),alignItems:"center"},button:{}}})),Y=function(){return Object(C.jsx)("div",{children:"Perform Activity and Search!"})},Q=function(e){var t=K(),n=H.getInstance(),i=Object(r.useState)([]),a=Object(d.a)(i,2),c=a[0],o=a[1];return Object(C.jsxs)(E.a,{className:t.box,children:[Object(C.jsx)(O.a,{variant:"contained",className:t.button,color:"primary","aria-label":"search",onClick:function(){n.getPlaylists(e.activity).then((function(e){var t=e.body.playlists.items;console.log(t),o(t)}))},children:"Search Playlists"}),0===c.length?Object(C.jsx)(Y,{}):Object(C.jsx)(z,{playlists:c,onPlaylistClick:function(e){return console.log(e)}})]})};function U(){return X.apply(this,arguments)}function X(){return(X=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!==typeof DeviceMotionEvent.requestPermission){e.next=7;break}return e.next=3,DeviceMotionEvent.requestPermission();case 3:if("granted"===e.sent){e.next=7;break}return console.error("Device Motion Permission not granted!"),e.abrupt("return",!1);case 7:if("function"!==typeof DeviceOrientationEvent.requestPermission){e.next=14;break}return e.next=10,DeviceOrientationEvent.requestPermission();case 10:if("granted"===e.sent){e.next=14;break}return console.error("DeviceOrientation Permission not granted!"),e.abrupt("return",!1);case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=n(70),$=Object(Z.a)({palette:{type:"dark",primary:{light:"#bef67a",main:"#8bc34a",dark:"#5a9216",contrastText:"#000000"},secondary:{light:"#484848",main:"#212121",dark:"#000000",contrastText:"#ffffff"}}}),ee=n(159),te=n(165),ne=n(160),re=n(158),ie=n(164),ae=Object(T.a)((function(e){return{events:{marginRight:e.spacing(1)}}})),ce=function(e){var t=ae(),n=e.activity,r=e.recording,i=e.onRecordingChange,a=e.recordedEvents;return Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(re.a,{control:Object(C.jsx)(ie.a,{size:"small",checked:r,onChange:function(){return i(!r)}}),label:"Recording"}),Object(C.jsxs)(y.a,{className:t.events,children:["Recorded Events: ",a]}),Object(C.jsxs)(y.a,{children:["Current Activity: ",n]})]})},oe=Object(T.a)((function(e){return{grow:{flexGrow:1}}})),se=function(e){var t=oe(),n=Object(ee.a)((function(e){return e.breakpoints.up("sm")}));return Object(C.jsx)(te.a,{position:"sticky",children:Object(C.jsxs)(ne.a,{children:[n?Object(C.jsx)(y.a,{variant:"h4",component:"h1",children:"Spotify Recommender"}):null,Object(C.jsx)("div",{className:t.grow}),Object(C.jsx)(ce,Object(G.a)(Object(G.a)({},e.state),{},{onRecordingChange:function(t){t?e.startRecording():e.stopRecording()}}))]})})},le=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).event_listener=void 0,r.timebuffer=void 0,r.model=void 0,r.inferenceCallback=function(e,t){if(void 0!==r.model){var n=r.model.calculate_features(e,t);r.model.infer(n).then((function(e){void 0!==e&&r.setState({activity:e})}))}},r.record=function(e,t,n,i){for(var a=0,c=Object.entries(t);a<c.length;a++){var o=Object(d.a)(c[a],2),s=o[0],l=o[1];r.timebuffer.push("".concat(s,"_").concat(e,"_"),l)}performance.timing.navigationStart;r.setState({recordedEvents:r.state.recordedEvents+1})},r.stopRecording=function(){var e,t=Object(u.a)(r.event_listener);try{for(t.s();!(e=t.n()).done;){var n=e.value;console.log("Stopping",n.event),window.removeEventListener(n.event,n.function,!0)}}catch(i){t.e(i)}finally{t.f()}r.setState({recording:!1})},r.startRecording=Object(l.a)(s.a.mark((function e(){var t,n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==r.state.recording){e.next=2;break}return e.abrupt("return");case 2:return console.log("Loading Model"),r.model=M.getInstance(),console.log("Model loaded"),e.next=7,U();case 7:if(e.sent){e.next=9;break}return e.abrupt("return");case 9:t=Object(u.a)(r.event_listener);try{for(t.s();!(n=t.n()).done;)i=n.value,console.log("Start listener",i.event),window.addEventListener(i.event,i.function,!0)}catch(a){t.e(a)}finally{t.f()}r.setState({recording:!0});case 12:case"end":return e.stop()}}),e)}))),r.state={recording:!1,recordedEvents:0,activity:"unknown"},r.devicemotion_listener=r.devicemotion_listener.bind(Object(h.a)(r)),r.deviceorientation_listener=r.deviceorientation_listener.bind(Object(h.a)(r)),r.event_listener=[{event:"deviceorientation",function:r.deviceorientation_listener},{event:"devicemotion",function:r.devicemotion_listener}],r.timebuffer=new F(1e3,r.inferenceCallback),r}return Object(v.a)(n,[{key:"devicemotion_listener",value:function(e){var t=e.timeStamp,n=e.type,r=e.accelerationIncludingGravity,i=r.x,a=r.y,c=r.z,o=e.rotationRate,s=o.alpha,l=o.beta,u=o.gamma;this.record(n,{x:i,y:a,z:c,alpha:s,beta:l,gamma:u},{},t)}},{key:"deviceorientation_listener",value:function(e){var t=e.alpha,n=e.beta,r=e.gamma,i=e.type,a=e.timeStamp;this.record(i,{alpha:t,beta:n,gamma:r},{},a)}},{key:"render",value:function(){return Object(C.jsx)(j.a,{theme:$,children:Object(C.jsx)(p.a,{children:Object(C.jsxs)("div",{className:"root",children:[Object(C.jsx)(se,{state:this.state,startRecording:this.startRecording,stopRecording:this.stopRecording}),Object(C.jsx)(g.a,{className:"content",children:Object(C.jsx)(Q,{activity:this.state.activity})}),Object(C.jsx)(R,{})]})})})}}]),n}(r.Component),ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,167)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),r(e),i(e),a(e),c(e)}))};c.a.render(Object(C.jsx)(i.a.StrictMode,{children:Object(C.jsx)(le,{})}),document.getElementById("root")),ue()},84:function(e,t,n){}},[[132,1,2]]]);
//# sourceMappingURL=main.6eb2f7a0.chunk.js.map